name: daily-algorithm-alert

on:
  schedule:
    - cron: '0 11 * * *'   # Run daily at 8 PM
    - cron: '0 11 * * 1'   # Run weekly on Mondays at 8 PM
    - cron: '0 11 1 * *'  # Run monthly on the 1st at 8 PM

jobs:
  alert-build:
    runs-on: ubuntu-latest

    steps:
      - name: Print Current time in workflow
        run: date

      - name: checkout repository
        uses: actions/checkout@v4

      #- name: POST algorithm repository daily alert to SLACK
      #  id: run-output-script
      #  run: bash shell-scripts/statistics-algorithm-java-files.sh

      - name: Send slack Notification
        run: |
          # Counting
          # DAILY_COUNT="${{ steps.run-output-script.outputs.DAILY_JAVA_COUNT }}"
          # WEEKLY_COUNT="${{ steps.run-output-script.outputs.WEEKLY_JAVA_COUNT }}"
          # MONTHLY_COUNT="${{ steps.run-output-script.outputs.MONTHLY_JAVA_COUNT }}"
          # CURRENT_DIR="${{ steps.run-output-script.outputs.CUREENT_DIR}}
          # echo ${CURRENT_DIR}
          
          echo "===================slack Message Send & staticstics===================" 
          
          # 현재 날짜 및 계산을 위한 기본 변수 설정
          echo -e "\e[31m===================DATE==================="
          TODAY=$(date +%Y-%m-%d)                             # 오늘 날짜 (YYYY-MM-DD 형식)
          YESTERDAY=$(date -d "yesterday" +%Y-%m-%d)          # 어제 날짜
          SEVEN_DAYS_AGO=$(date -d "7 days ago" +%Y-%m-%d)    # 일주일 전 날짜
          THIRTY_DAYS_AGO=$(date -d "30 days ago" +%Y-%m-%d)  # 한 달 전 날짜
          NOW_YEAR=$(date +%Y)  
          NOW_MONTH=$(date +%0m)
          echo ${NOW_YEAR}-${NOW_MONTH}-${NOW_DATE}
          echo -e "\e[31m===================DATE==================="
          
          DAILY_COUNT=$(find . -type f -name "*.java" -newermt "${YESTERDAY}" ! -newermt "${TODAY}" | wc -l)
          WEEKLY_COUNT=$(find . -type f -name "*.java" -newermt "${SEVEN_DAYS_AGO}" ! -newermt "${TODAY}" | wc -l)
          MONTHLY_COUNT=$(find . -type f -name "*.java" -newermt "${THIRTY_DAYS_AGO}" ! -newermt "${TODAY}" | wc -l)
          
          echo -e "\e[31m+====================================================+";
          echo -e "\e[32mJava Files Created Yesterday: ${DAILY_COUNT}"
          echo -e "\e[32mJava Files Created Last 7 Days: ${WEEKLY_COUNT}"
          echo -e "\e[32mJava Files Created Last 30 Days: ${MONTHLY_COUNT}"
          echo -e "\e[31m+====================================================+";
  
          # Slack Message Send & Statistics
          if [ ${DAILY_COUNT} -lt 1 ]; then 
            MSG="더 분발해야 할 것 같아요!"
          elif [ ${DAILY_COUNT} -ge 2 -a ${DAILY_COUNT} -lt 3 ]; then
            MSG="지금까지 잘하고 계시네요. 화이팅입니다!"
          elif [ ${DAILY_COUNT} -ge 3 -a ${DAILY_COUNT} -lt 4 ]; then
            MSG="목표를 거의 달성하셨어요! 대단합니다."
          else
            MSG="4 문제 이상 푸셔서, 존경스럽습니다."
          fi
          echo "===================slack Message Send & staticstics==================="
          
          # algorithm State Alert
          DAILY_MSG="알고리즘 풀기 좋은 밤이죠?\n오늘 날짜(${TODAY})기준으로 ${NOW_YEAR}년 ${NOW_MONTH}월 ${DAILY_COUNT}개 달성하셨어요!\n통계를 말씀드리자면, 주간 ${WEEKLY_COUNT}개, 월간 ${MONTHLY_COUNT}개 입니다!\n${MSG}\n 자세히 알아보려면 <https://github.com/yeeooni/baekjoon-slove|여기를 클릭>하세요."
          
          # SLACK channel to SEND
          curl -X POST --data-urlencode "payload={\"text\": \"${DAILY_MSG}\", \"icon_emoji\": \":male-technologist:\"}" ${{ secrets.SLACK_WEBHOOKS_URL }}
          
            
          
          
          
