name: weekly-algorithm-alert

on:
  schedule:
    - cron: '0 9 * * 5'   # Run weekly on Fridays at 8 PM

jobs:
  alert-build:
    runs-on: ubuntu-latest

    steps:
      - name: checkout repository
        uses: actions/checkout@v4

      - name: Set Timezone to Asia/Seoul
        run: sudo timedatectl set-timezone Asia/Seoul

      - name: Run Shell Script to Count Java Files
        run: |
            chmod +x ./shell-scripts/cal-months-algorithm-slove.sh  # ìŠ¤í¬ë¦½íŠ¸ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
            bash shell-scripts/cal-months-algorithm-slove.sh 6   # ê³¼ê±° 6ê°œì›” ì „ë¶€í„° í˜„ì¬ê¹Œì§€ íŒŒì¼ ê°œìˆ˜ ê³„ì‚°

      - name: Slack Message Send & Statistics
        run: |
          COUNT_MSG="\n"
          COUNT_MSG+=":tada: *ë¬¸ì œ í•´ê²° í†µê³„ ë³´ê³ ì„œ* :rocket:\n"
          COUNT_MSG+="\`\`\`\n"
          COUNT_MSG+="ğŸ“… ${date +%Y}ë…„ ê¸°ì¤€, ${{ env.MONTHS_AGO }}ê°œì›” ì „ë¶€í„° ì§€ê¸ˆê¹Œì§€\n"
          COUNT_MSG+="âœ… ì´ í•´ê²°í•œ ë¬¸ì œ ìˆ˜: ${{ env.FIRST_COMMIT_COUNT }}ë¬¸ì œ\n"
          COUNT_MSG+="\`\`\`\n"
          COUNT_MSG+="ğŸ‘ *ì •ë§ ëŒ€ë‹¨í•´ìš”!* ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ê²°ì‹¤ì„ ë§ºê³  ìˆì–´ìš”.\n"
          COUNT_MSG+="ğŸ”¥ ë‹¤ìŒ ë‹¬ë„ ë©ˆì¶”ì§€ ë§ê³  ê³„ì† ë„ì „í•´ë´ìš”!\n"
          
          # SLACK channel to SEND
          curl -X POST --data-urlencode "payload={\"text\": \"${COUNT_MSG}\"}" ${{ secrets.SLACK_WEBHOOKS_URL }}